# GitHub workflow for deploying the documentation to GitHub Pages
name: deploy_doc

on:
    push:
        branches:
          - main
        paths:
          - 'doc/**'

jobs:
    deploy_doc:
        runs-on: ubuntu-latest
        steps:
          - name: üõéÔ∏è Checkout
            uses: actions/checkout@v3
          - name: üìñ Build documentation
            run: |
                sleep 1
                docker run \
                    -v "${GITHUB_WORKSPACE}":/github \
                    --name "${GITHUB_REPOSITORY//\//_}__${GITHUB_WORKFLOW}__${GITHUB_JOB}__$(date +%s)" \
                    --rm \
                    ${docker_username}/concept:latest \
                    bash -O extglob -c ': \
                        && source ~/.bashrc \
                        && rm -rf "${concept_dir}/"!(dep) \
                        && cp -r /github/!(dep) "${concept_dir}/" \
                        && (cd "${concept_dir}" && make clean-doc && make doc) \
                        && sudo su -c "rm -rf /github/publish" \
                        && sudo su -c "cp -r \"${doc_dir}/publish\" /github/" \
                        && sudo su -c "chmod -R a+rwX /github/publish" \
                    '
          - name: üöÄ Deploy documentation
            uses: peaceiris/actions-gh-pages@v3
            with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                publish_dir: publish
